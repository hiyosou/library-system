<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“š æ›¸ç±æ¤œç´¢</title>

    <style>
        body { font-family: "Yu Gothic"; background:#F5F6FB; padding:40px 10%; }
        h1 { color:#303585; border-left:8px solid #303585; padding-left:15px; }
        #searchBox {
            width: 300px; padding: 10px 14px;
            border: 1px solid #C8CBE6; border-radius: 6px;
        }
        #bookList { list-style:none; padding-left:0; margin-top:15px; }
        #bookList li {
            background:white; padding:12px; margin:6px 0;
            border-radius:8px; border:1px solid #D5D8EF;
        }
    </style>
</head>
<body>

<h1>ğŸ” æ›¸ç±æ¤œç´¢</h1>

<input type="text" id="searchBox" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ãƒ»è‘—è€…ã§æ¤œç´¢...">

<ul id="bookList"></ul>

<h2>æ›¸ç±ä¸€è¦§</h2>
<button id="loadBooksBtn">ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€</button>
<ul id="booksList"></ul>
<div id="loadresult"></div>
<script>
let allBooks = [];

// ãƒ™ãƒ¼ã‚¹URLã‚’å–å¾—ï¼ˆHTTPSã‚’å¼·åˆ¶ï¼‰
const getBaseUrl = () => {
    return window.location.origin.replace('http://', 'https://');
};

async function loadBooks() {
    console.log(`${getBaseUrl()}/books`)
    try{
        const response = await fetch(`${getBaseUrl()}/books`);
        allBooks = await response.json();
    } catch(e) {
        console.log(e);
    }
    displayBooks(allBooks);
}

function displayBooks(list) {
    const ul = document.getElementById("bookList");
    ul.innerHTML = "";
    list.forEach(book => {
        const li = document.createElement("li");
        li.textContent = `${book.title} (${book.author})`;
        ul.appendChild(li);
    });
}

document.getElementById("searchBox").addEventListener("input", e => {
    const key = e.target.value.toLowerCase();
    const filtered = allBooks.filter(book =>
        book.title.toLowerCase().includes(key) ||
        book.author.toLowerCase().includes(key)
    );
    displayBooks(filtered);
});

loadBooks();


async function fetchBooks() {
    const res = await fetch(`${getBaseUrl()}/books`);
    allBooks = await res.json();
    return allBooks;
}

function displayFullList(list) {
    const ul = document.getElementById("booksList");
    ul.innerHTML = "";
    list.forEach(book => {
        const li = document.createElement("li");
        li.textContent = `ID: ${book.id} / ${book.title} (${book.author})`;
        ul.appendChild(li);
    });
}

window.addEventListener("DOMContentLoaded", async () => {
    const books = await fetchBooks();
    displayFullList(books);
});

document.getElementById("loadBooksBtn").addEventListener("click", async () => {
    document.getElementById("loadresult").innerText = "èª­ã¿è¾¼ã¿ä¸­...";
    const books = await fetchBooks();
    displayFullList(books);
});

</script>
<a href="/index">ğŸ“š æ›¸ç±ç®¡ç†ãƒšãƒ¼ã‚¸ã¸(æ¨©é™ãŒå¿…è¦ã§ã™)</a>

</body>
</html>
