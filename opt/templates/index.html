<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Book Manager</title>
</head>
<body>
    <h1>ğŸ“šé«˜æ©‹ç ”ç©¶å®¤æ›¸ç±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>


    <h2>æ–°ã—ã„æœ¬ã‚’ç™»éŒ²</h2>
    <form id="addBookForm">
        <input type="text" id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" required>
        <input type="text" id="author" placeholder="è‘—è€…" required>
        <button type="submit">ç™»éŒ²</button>
    </form>
    <div id="pushresult" style="margin-top:20px; color:green;"></div>
    <script>
         document.getElementById("addBookForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const title = document.getElementById("title").value;
            const author = document.getElementById("author").value;

            const response = await fetch("/books", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ title, author })
            });

            const data = await response.json();
            document.getElementById("pushresult").innerText = data.message;
        });
    </script>

    <h2>æ›¸ç±ä¸€è¦§</h2>
    <button id="loadBooksBtn">æ›¸ç±ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€</button>
    <ul id="booksList"></ul>
    <div id="loadresult" style="margin-top:10px; color:blue;"></div>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ›¸ç±ä¸€è¦§ã‚’å–å¾—
        async function loadBooks() {
            document.getElementById("loadresult").innerText = "èª­ã¿è¾¼ã¿ä¸­...";
            try {
                const response = await fetch("/books", {
                    method: "GET",
                    headers: {"Content-Type": "application/json"}
                });

                if (!response.ok) {
                    throw new Error("æ›¸ç±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
                }

                const books = await response.json();
                const booksList = document.getElementById("booksList");
                booksList.innerHTML = ""; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

                if (books.length === 0) {
                    booksList.innerHTML = "<li>ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹æ›¸ç±ã¯ã‚ã‚Šã¾ã›ã‚“</li>";
                } else {
                    books.forEach(book => {
                        const li = document.createElement("li");
                        li.textContent = `ID: ${book.id} / ã‚¿ã‚¤ãƒˆãƒ«: ${book.title} / è‘—è€…: ${book.author}`;
                        booksList.appendChild(li);
                    });
                }
                document.getElementById("loadresult").innerText = `${books.length}ä»¶ã®æ›¸ç±ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`;
            } catch (error) {
                document.getElementById("loadresult").innerText = "ã‚¨ãƒ©ãƒ¼: " + error.message;
            }
        }

        // ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§æ›¸ç±ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€
        document.getElementById("loadBooksBtn").addEventListener("click", loadBooks);

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§æ›¸ç±ä¸€è¦§ã‚’å–å¾—
        window.addEventListener("DOMContentLoaded", loadBooks);

        // æ›¸ç±ç™»éŒ²å¾Œã«è‡ªå‹•ã§ãƒªã‚¹ãƒˆã‚’æ›´æ–°
        document.getElementById("addBookForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const title = document.getElementById("title").value;
            const author = document.getElementById("author").value;

            const response = await fetch("/books", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ title, author })
            });

            const data = await response.json();
            document.getElementById("pushresult").innerText = data.message;
            
            // ç™»éŒ²æˆåŠŸå¾Œã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ã—ã¦ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
            if (response.ok) {
                document.getElementById("title").value = "";
                document.getElementById("author").value = "";
                loadBooks();
            }
        });
    </script>
    
    <h2>æœ¬ã®æƒ…å ±ã‚’æ›´æ–°</h2>
    <form id="updateBookForm">
        <input type="number" id="updateId" placeholder="æ›¸ç±ID" required>
        <input type="text" id="newTitle" placeholder="æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«">
        <input type="text" id="newAuthor" placeholder="æ–°ã—ã„è‘—è€…">
        <button type="submit">æ›´æ–°</button>
    </form>
    <div id="putresult" style="margin-top:20px; color:green;"></div>

<script>
         document.getElementById("updateBookForm").addEventListener("submit", async (event) => {
            event.preventDefault();

            const id = document.getElementById("updateId").value;
            const newTitle = document.getElementById("newTitle").value;
            const newAuthor = document.getElementById("newAuthor").value;

            const response = await fetch(`/books/${id}`, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ title: newTitle, author: newAuthor })
            });

            const data = await response.json();
            document.getElementById("putresult").innerText = data.message;
            
            // æ›´æ–°æˆåŠŸå¾Œã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ã—ã¦ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
            if (response.ok) {
                document.getElementById("updateId").value = "";
                document.getElementById("newTitle").value = "";
                document.getElementById("newAuthor").value = "";
                loadBooks();
            }
        });
   </script>
   <h2>æœ¬ã‚’å‰Šé™¤</h2>
<form id="deleteBookForm">
    <input type="number" id="deleteId" placeholder="æ›¸ç±ID" required>
    <button type="submit">å‰Šé™¤</button>
</form>
<div id="deleteresult" style="margin-top:20px; color:red;"></div>

<script>
    document.getElementById("deleteBookForm").addEventListener("submit", async (event) => {
        event.preventDefault();

        const id = document.getElementById("deleteId").value;

        const response = await fetch(`/books/${id}`, {
            method: "DELETE",
        });

        const data = await response.json();
        document.getElementById("deleteresult").innerText = data.message;
        
        // å‰Šé™¤æˆåŠŸå¾Œã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ã—ã¦ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
        if (response.ok) {
            document.getElementById("deleteId").value = "";
            loadBooks();
        }
    });
</script>

   
</body>
</html>
