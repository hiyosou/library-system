<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“š æ›¸ç±ç®¡ç†</title>
    <style>
        body { font-family:"Yu Gothic"; background:#F5F6FB; padding:40px 10%; }
        h1 { color:#303585; border-left:8px solid #303585; padding-left:15px; }
        h2 { color:#303585; margin-top:30px; }
        form { margin-bottom:20px; }
        input { padding:10px; border:1px solid #C8CBE6; border-radius:6px; }
        button {
            background:#4B4FA3; color:white; padding:10px 20px;
            border:none; border-radius:6px; cursor:pointer;
        }
        ul { list-style:none; padding-left:0; }
        ul li { background:white; padding:12px; border-radius:8px; margin:6px 0; border:1px solid #D5D8EF; }
        div { margin-top:10px; }
    </style>
</head>
<body>

<h1>ğŸ“š æ›¸ç±ç®¡ç†ï¼ˆç™»éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼‰</h1>

<!-- æ–°è¦ç™»éŒ² -->
<h2>æ–°ã—ã„æœ¬ã‚’ç™»éŒ²</h2>
<form id="addBookForm">
    <input type="text" id="title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" required>
    <input type="text" id="author" placeholder="è‘—è€…" required>
    <button type="submit">ç™»éŒ²</button>
</form>
<div id="pushresult"></div>

<!-- ä¸€è¦§ -->
<h2>æ›¸ç±ä¸€è¦§</h2>
<button id="loadBooksBtn">ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€</button>
<ul id="booksList"></ul>
<div id="loadresult"></div>

<!-- æ›´æ–° -->
<h2>æ›¸ç±æ›´æ–°</h2>
<form id="updateBookForm">
    <input type="number" id="updateId" placeholder="ID" required>
    <input type="text" id="newTitle" placeholder="æ–°ã—ã„ã‚¿ã‚¤ãƒˆãƒ«">
    <input type="text" id="newAuthor" placeholder="æ–°ã—ã„è‘—è€…">
    <button type="submit">æ›´æ–°</button>
</form>
<div id="putresult"></div>

<!-- å‰Šé™¤ -->
<h2>æ›¸ç±å‰Šé™¤</h2>
<form id="deleteBookForm">
    <input type="number" id="deleteId" placeholder="ID" required>
    <button type="submit">å‰Šé™¤</button>
</form>
<div id="deleteresult"></div>

<script>
let allBooks = [];

// æ›¸ç±ä¸€è¦§ã‚’å–å¾—
async function fetchBooks() {
    const res = await fetch("/books");
    allBooks = await res.json();
    return allBooks;
}

// æ›¸ç±ä¸€è¦§ã‚’è¡¨ç¤º
function displayFullList(list) {
    const ul = document.getElementById("booksList");
    ul.innerHTML = "";
    list.forEach(book => {
        const li = document.createElement("li");
        li.textContent = `ID: ${book.id} / ${book.title} (${book.author})`;
        ul.appendChild(li);
    });
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ã§ä¸€è¦§è¡¨ç¤º
window.addEventListener("DOMContentLoaded", async () => {
    const books = await fetchBooks();
    displayFullList(books);
});

// æ‰‹å‹•ã§ä¸€è¦§å–å¾—
document.getElementById("loadBooksBtn").addEventListener("click", async () => {
    document.getElementById("loadresult").innerText = "èª­ã¿è¾¼ã¿ä¸­...";
    const books = await fetchBooks();
    displayFullList(books);
    document.getElementById("loadresult").innerText = `${books.length}ä»¶ã®æ›¸ç±ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`;
});

// æ–°è¦ç™»éŒ²
document.getElementById("addBookForm").addEventListener("submit", async e => {
    e.preventDefault();
    const title = document.getElementById("title").value;
    const author = document.getElementById("author").value;

    const res = await fetch("/books", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ title, author })
    });
    const data = await res.json();
    document.getElementById("pushresult").innerText = data.message;

    const books = await fetchBooks();
    displayFullList(books);

    document.getElementById("title").value = "";
    document.getElementById("author").value = "";
});

// æ›´æ–°
document.getElementById("updateBookForm").addEventListener("submit", async e => {
    e.preventDefault();
    const id = document.getElementById("updateId").value;
    const newTitle = document.getElementById("newTitle").value;
    const newAuthor = document.getElementById("newAuthor").value;

    const res = await fetch(`/books/${id}`, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ title: newTitle, author: newAuthor })
    });
    const data = await res.json();
    document.getElementById("putresult").innerText = data.message;

    const books = await fetchBooks();
    displayFullList(books);

    document.getElementById("updateId").value = "";
    document.getElementById("newTitle").value = "";
    document.getElementById("newAuthor").value = "";
});

// å‰Šé™¤
document.getElementById("deleteBookForm").addEventListener("submit", async e => {
    e.preventDefault();
    const id = document.getElementById("deleteId").value;

    const res = await fetch(`/books/${id}`, { method: "DELETE" });
    const data = await res.json();
    document.getElementById("deleteresult").innerText = data.message;

    const books = await fetchBooks();
    displayFullList(books);

    document.getElementById("deleteId").value = "";
});
</script>

<a href="/search">ğŸ” æ¤œç´¢ãƒšãƒ¼ã‚¸ã¸</a>

</body>
</html>
